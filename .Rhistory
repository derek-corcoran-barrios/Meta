preds <- predict(res9, newmods = NM[,1:2])
preds <- predict(res9, newmods = newmods, addx = TRUE)
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds
View(preds)
model9
NM <- cbind(newmods[,1],predict(dum, newmods))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
dat1$Nesting.Area
summary(dat1$Nesting.Area)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
library(caret)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Nesting.Area = c("aboveground", "both"))
dum <- dummyVars(~ Nesting.Area, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res10, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
dum <- dummyVars(~ Nesting.Area, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res10, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model10 <- data.frame(model = "y ~ Concentration [g/kg] + Nesting Area", p_value = res10$QMp, R_squared = round(res10$R2/100,2), AICc = res10$fit.stats$ML[5])
model10
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
dat1$Functional.group
summary(dat1$Functional.group)
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(AI.Rate_T1 = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = Functional.group, alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
preds
NM
newmods
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2], Functional.group = newmods$Functional.group)
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = Functional.group, alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
preds
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
dat1$AI.type
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
Meta$Study.Type
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
Meta$Study.Type
Behavior$Study.Type
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
res5 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Studt.Type), slab = paste(dat1$Authors, dat1$Year))
model5 <- data.frame(model = "y ~ study type", p_value = res5$QMp, R_squared = round(res5$R2/100,2), AICc = res5$fit.stats$ML[5])
dat1$Study.Type
res5 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Study.Type), slab = paste(dat1$Authors, dat1$Year))
model5 <- data.frame(model = "y ~ study type", p_value = res5$QMp, R_squared = round(res5$R2/100,2), AICc = res5$fit.stats$ML[5])
model5
vars<-c('a','b','c','d')
library(gregmisc)
indexes<-unique(apply(combinations(length(vars), length(vars), repeats=T), 1, unique))
gen.form<-function(x) as.formula(paste('~',paste( vars[x],collapse='+')))
formulas<-lapply(indexes, gen.form)
formulas
install.packages("gregmisc")
install.packages(gregmisc)
regMat <- expand.grid(c(TRUE,FALSE), c(TRUE,FALSE),
c(TRUE,FALSE), c(TRUE,FALSE))
regMat
regMat <- expand.grid(c(TRUE,FALSE), c(TRUE,FALSE),
c(TRUE,FALSE), c(TRUE,FALSE), c(TRUE, FALSE))
regMat
dat1$AI.type
exp(-0.5)
ALL
Meta$Fitness.measure
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res1 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Functional.group) + factor(Order), slab = paste(dat1$Authors, dat1$Year))
model1 <- data.frame(model = "y ~ Order + Functional group", p_value = res1$QMp, R_squared = round(res1$R2/100,2), AICc = res1$fit.stats$ML[5])
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
library(metafor)
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res1 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Functional.group) + factor(Order), slab = paste(dat1$Authors, dat1$Year))
model1 <- data.frame(model = "y ~ Order + Functional group", p_value = res1$QMp, R_squared = round(res1$R2/100,2), AICc = res1$fit.stats$ML[5])
model1
Meta$Treatment.2
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
dat1$Treatment.2
summary(dat1$Treatment.2)
res1
res2
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
Reproduction_ppb <- Reproduction[!is.na(Reproduction$T1_ppb),]
Reproduction_ppb_t2 <- dplyr::filter(Reproduction_ppb, !is.na(T2_ppb))
Reproduction_ppb_t2$T1_ppb <- Reproduction_ppb_t2$T2_ppb
Reproduction_ppb_t2$T1_Mean <- Reproduction_ppb_t2$T2_Mean
Reproduction_ppb_t2$T1_SE <- Reproduction_ppb_t2$T2_SE
Reproduction_ppb_t2$Study.T1..n. <- Reproduction_ppb_t2$Study.T2..n.
Reproduction_ppb <- rbind(Reproduction_ppb, Reproduction_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction_ppb, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + Treatment.2, slab = paste(dat1$Authors, dat1$Year))
summary(dat1$Treatment.2)
res4
summary(dat1$Treatment.2)
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI", "MIX", "THX"))
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res3, newmods = NM[,1:3])
preds <- predict(res4, newmods = NM[,1:3])
preds <- predict(res4, newmods = NM[,1:4])
preds
model4 <- data.frame(model = "y ~ Concentration [ppb] + Neonic type", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
model4
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
class(preds)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, T1_ppb = newmods$T1_ppb, Treatment.2 = newmods$Treatment.2)
model4 <- data.frame(model = "y ~ Concentration [ppb] + Neonic type", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type") + scale_size(name = "n")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type") + scale_size(name = "n") + scale_x_log10()
res5
res4
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Meta <- readRDS("Meta.rds")
library(ggplot2)
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2$T2_ppb
Behavior_ppb_t2$T1_Mean <- Behavior_ppb_t2$T2_Mean
Behavior_ppb_t2$T1_SE <- Behavior_ppb_t2$T2_SE
Behavior_ppb_t2$Study.T1..n. <- Behavior_ppb_t2$Study.T2..n.
Behavior_ppb <- rbind(Behavior_ppb, Behavior_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res3 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + factor(Treatment.2), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI"))
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res3, newmods = NM[,1:2])
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, T1_ppb = newmods$T1_ppb, Treatment.2 = newmods$Treatment.2)
model3 <- data.frame(model = "y ~ Concentration + neonic type", p_value = res3$QMp, R_squared = round(res3$R2/100,2), AICc = res3$fit.stats$ML[5])
preds
NM
res3
dat1$Treatment.2
summary(dat1$Treatment.2)
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
Reproduction_ppb <- Reproduction[!is.na(Reproduction$T1_ppb),]
Reproduction_ppb_t2 <- dplyr::filter(Reproduction_ppb, !is.na(T2_ppb))
Reproduction_ppb_t2$T1_ppb <- Reproduction_ppb_t2$T2_ppb
Reproduction_ppb_t2$T1_Mean <- Reproduction_ppb_t2$T2_Mean
Reproduction_ppb_t2$T1_SE <- Reproduction_ppb_t2$T2_SE
Reproduction_ppb_t2$Study.T1..n. <- Reproduction_ppb_t2$Study.T2..n.
Reproduction_ppb <- rbind(Reproduction_ppb, Reproduction_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction_ppb, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + Treatment.2, slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI", "MIX", "THX"))
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res4, newmods = NM[,1:4])
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, T1_ppb = newmods$T1_ppb, Treatment.2 = newmods$Treatment.2)
model4 <- data.frame(model = "y ~ Concentration [ppb] + Neonic type", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
Reproduction_ppb$T1_ppb
hist(Reproduction_ppb$T1_ppb)
length(Reproduction_ppb$T1_ppb)
length(Reproduction_ppb$T1_ppb < 5000)
length(Reproduction_ppb$T1_ppb < 4000)
length(Reproduction_ppb$T1_ppb < 2000)
max(Reproduction_ppb$T1_ppb < 2000)
max(Reproduction_ppb$T1_ppb > 2000)
max(Reproduction_ppb$T1_ppb)
sum(Reproduction_ppb$T1_ppb < 5000)
test <-Reproduction_ppb$T1_ppb[Reproduction_ppb$T1_ppb < 5000,]
test <-Reproduction_ppb$T1_ppb[Reproduction_ppb$T1_ppb < 5000]
hist(test)
test <-Reproduction_ppb$T1_ppb[Reproduction_ppb$T1_ppb < 600]
hist(test)
test <-Reproduction_ppb$T1_ppb[Reproduction_ppb$T1_ppb < 200]
hist(test)
length(test)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(AI.Rate_T1 = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2], Functional.group = newmods$Functional.group)
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
dat1$AI.Rate_T1
dat1$AI.Rate_T1
dat1$AI.type
colnames(dat1)
dat1$Application.Units
Meta_MasterDataNEW_March.8 <- read.csv("~/Documents/Meta/Meta/Meta_MasterDataNEW_March 8.csv", sep=";")
View(Meta_MasterDataNEW_March.8)
Meta_MasterDataNEW_March.8$AI.Rate_T1
install.packages("googlesheets")
library(googlesheets)
library(dplyr)
gs_ls()
gap <- gs_title("Meta_March16")
gap
GAP_KEY <- gs_gap_key()
GAP_KEY
?gs_read
gs_read(gap)
a<-gs_read(gap)
a
class(a)
View(a)
Meta<- as.data.frame(a)
MEta
Meta
View(Meta)
saveRDS(Meta, "Meta.rds")
Meta <- readRDS("Meta.rds")
View(Meta)
Meta$`AI Rate_T1`
Meta_MasterDataNEW_March.8
colnames(Meta_MasterDataNEW_March.8)
colnames(Meta) <- colnames(Meta_MasterDataNEW_March.8)
colnames(meta)
colnames(Meta)
saveRDS(Meta, "Meta.rds")
Meta <- readRDS("Meta.rds")
View(Meta)
Meta$TreatmentType
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2$T2_ppb
Behavior_ppb_t2$T1_Mean <- Behavior_ppb_t2$T2_Mean
Behavior_ppb_t2$T1_SE <- Behavior_ppb_t2$T2_SE
Behavior_ppb_t2$Study.T1..n. <- Behavior_ppb_t2$Study.T2..n.
Behavior_ppb <- rbind(Behavior_ppb, Behavior_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
#res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb +  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration [ppb]", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_size("Number of studies") + scale_x_continuous(labels = scales::comma)
model2
Behavior_ppb
Behavior_ppb <- dplyr::filter(Behavior_ppb, T1_ppb < 300000)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration [ppb]", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
model2
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_size("Number of studies") + scale_x_continuous(labels = scales::comma)
Behavior_ppb <- dplyr::filter(Behavior_ppb, T1_ppb < 20000)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
#res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb +  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration [ppb]", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_size("Number of studies") + scale_x_continuous(labels = scales::comma)
Behavior_ppb <- dplyr::filter(Behavior_ppb, T1_ppb < 1000)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
#res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb +  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration [ppb]", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_size("Number of studies") + scale_x_continuous(labels = scales::comma)
library(googlesheets)
gs_ls
gs_ls()
gap <- gs_title("Meta_March16")
a<-gs_read(gap)
a
class(a)
View(a)
Meta <- readRDS("Meta.rds")
colnames(meta)
colnames(Meta)
colnames(a)
colnames(Meta)
colnames(a) <- colnames(Meta)
colnames(a)
getwd()
setwd(paste(getwd(),"/MetanalysisNeonics", sep = ""))
getwd()
saveRDS(a, "Meta.rds")
gs_ls()
b <- gs_ls()
b$sheet_title
gap <- gs_title("Meta-Analysis Data_March 21 FINAL")
a<-gs_read(gap)
View(a)
colnames(a)
saveRDS(a, "Meta2.rds")
make.names(colnames(a))
colnames(a) <- make.names(colnames(a))
colnames(a)
saveRDS(a, "Meta2.rds")
Meta <- readRDS("Meta2.rds")
library(ggplot2)
library(metafor)
ggplot(Meta, aes(x=reorder(Fitness.measure,Fitness.measure, function(x)-length(x)))) + geom_bar() + xlab("Performance measure") + ylab("Number of studies") + theme_classic()
library(metafor)
#Abundance
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
Abund <- data.frame(estimate = res$b, ci.ub = res$ci.ub, ci.lb = res$ci.lb, group = c("Abundance"), p = res$pval, n =nrow(Abundance), I2= res$I2, pvalCT = res$QEp)
#Behavior
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
Behav <- data.frame(estimate = res2$b, ci.ub = res2$ci.ub, ci.lb = res2$ci.lb, group = c("Behavior"), p = res2$pval, n =nrow(Behavior), I2= res2$I2, pvalCT = res2$QEp)
#Survival
survival <- dplyr::filter(Meta, Fitness.measure == "survival")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=survival, vtype = "UB")
res3 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
Surviv <- data.frame(estimate = res3$b, ci.ub = res3$ci.ub, ci.lb = res3$ci.lb, group = c("Survival"), p = res3$pval, n =nrow(survival), I2= res3$I2, pvalCT = res3$QEp)
#Reproduction
reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=reproduction, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
Reprod <- data.frame(estimate = res4$b, ci.ub = res4$ci.ub, ci.lb = res4$ci.lb, group = c("Reproduction"), p = res4$pval, n =nrow(reproduction), I2= res4$I2, pvalCT = res4$QEp)
#Condition
condition <- dplyr::filter(Meta, Fitness.measure == "condition")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=condition, vtype = "UB")
res5 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
Cond <- data.frame(estimate = res5$b, ci.ub = res5$ci.ub, ci.lb = res5$ci.lb, group = c("Condition"), p = res5$pval, n =nrow(condition), I2= res5$I2, pvalCT = res5$QEp)
All <- rbind(Abund, Behav, Surviv, Reprod, Cond)
knitr::kable(All, digits = 3, row.names = FALSE, caption = "effect size of the Standardized mean difference for each type of estimation of performance, it's standard error and p-value")
All <- All[-4,]
ggplot(All, aes(x = group, y = estimate)) + geom_point(aes(size = n)) + coord_flip() + geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub),width=0.0) + geom_hline(yintercept = 0, linetype=2) + ylim(c(-10, 10)) + ylab(c("Standardized Mean Difference")) + theme_classic() + xlab(c(""))
ggplot(All, aes(x = group, y = estimate)) + geom_point(aes(size = n)) + coord_flip() + geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub),width=0.0) + geom_hline(yintercept = 0, linetype=2) + ylim(c(-14, 14)) + ylab(c("Standardized Mean Difference")) + theme_classic() + xlab(c(""))
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
model0 <- data.frame(model = "y ~ 1", p_value = res$QMp, R_squared = 0, AICc = res$fit.stats$ML[5])
nullmod <- data.frame(estimate = res$b, ci.ub = res$ci.ub, ci.lb = res$ci.lb, group = c("Null"), p = res$pval, n =nrow(Abundance))
res0 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  factor(Functional.group) - 1, slab = paste(dat1$Authors, dat1$Year))
functionalgroup <- data.frame(estimate = res0$b, ci.ub = res0$ci.ub, ci.lb = res0$ci.lb, group = c("detritivore","mixed", "omnivore", "pollinator", "predator"), p = res0$pval, n = c(length(dplyr::filter(Abundance, Functional.group == "detritivore")$Functional.group),length(dplyr::filter(Abundance, Functional.group == "mixed")$Functional.group), length(dplyr::filter(Abundance, Functional.group == "omnivore")$Functional.group), length(dplyr::filter(Abundance, Functional.group == "pollinator")$Functional.group), length(dplyr::filter(Abundance, Functional.group == "predator")$Functional.group)))
res1 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
model1 <- data.frame(model = "y ~ Functional group", p_value = res1$QMp, R_squared = round(res1$R2/100,2), AICc = res1$fit.stats$ML[5])
model1
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
nullmod <- data.frame(estimate = res$b, ci.ub = res$ci.ub, ci.lb = res$ci.lb, group = c("Null"), p = res$pval, n =nrow(Abundance))
res0 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  factor(Nesting.Area) - 1, slab = paste(dat1$Authors, dat1$Year))
NestingArea <- data.frame(estimate = res0$b, ci.ub = res0$ci.ub, ci.lb = res0$ci.lb, group = c("aboveground","both", "ground"), p = res0$pval, n = c(length(dplyr::filter(Abundance, Functional.group == "aboveground")$Nesting.Area),length(dplyr::filter(Abundance, Functional.group == "both")$Nesting.Area), length(dplyr::filter(Abundance, Functional.group == "ground")$Nesting.Area)))
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
model4 <- data.frame(model = "y ~ Nesting Area", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha <- dplyr::filter(Abundance_kg_ha, TreatmentType == "powder/granular")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_kg_ha, vtype = "UB")
res7 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res7, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model7 <- data.frame(model = "y ~ Concentration [Kg/Ha]", p_value = res7$QMp, R_squared = round(res7$R2/100,2), AICc = res7$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res8 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res8, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model8 <- data.frame(model = "y ~ Concentration [g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res8$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(AI.Rate_T1 = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2], Functional.group = newmods$Functional.group)
preds <- predict(res9, newmods = NM[,1:3], addx = TRUE)
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
Reproduction_ppb <- Reproduction[!is.na(Reproduction$T1_ppb),]
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction_ppb, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + Treatment.2, slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI", "MIX", "THX"))
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res4, newmods = NM[,1:4])
res4
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
Reproduction_ppb <- Reproduction[!is.na(Reproduction$T1_ppb),]
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction_ppb, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + Treatment.2, slab = paste(dat1$Authors, dat1$Year))
res4
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(AI.Rate_T1 = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:3], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2], Functional.group = newmods$Functional.group)
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
res9
?scale_size()
View(mtcars)
ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point(aes(size= disp))
hist(mtcars$disp)
scale_size_manual()
?scale_size_manual()
a$Authors
unique(a$Authors)
library(ggplot2)
Meta <- readRDS("Meta2.rds")
library(ggplot2)
library(metafor)
dplyr::filter(Meta, Authors != "Tinsley et al.")
Meta <- dplyr::filter(Meta, Authors != "Tinsley et al.")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res8 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
res8
preds <- predict(res8, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model8 <- data.frame(model = "y ~ Concentration [g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res8$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
res9
unique(dat1$Functional.group)
b <- gs_ls()
b$sheet_title
b <- gs_ls()
b$sheet_title
gap <- gs_title("Meta-Analysis Data_March 22 TEST")
a<-gs_read(gap)
colnames(a) <- make.names(colnames(a))
saveRDS(a, "Meta3.rds")
gs_ls()
b$sheet_title
gap <- gs_title("Censo guanacos San Gregorio 2015")
a<-gs_read(gap)
a
View(a)
