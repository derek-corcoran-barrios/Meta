Abundance <- Abundance[!is.na(Abundance$T1_ppb),]
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
rstandard(res2)
rstandard(res2)$resid
hist(rstandard(res2)$resid)
shapiro.test(rstandard(res2)$resid)
shapiro.test(rnorm(100))
shapiro.test(rnorm(100))
shapiro.test(rnorm(100))
shapiro.test(rnorm(100))
shapiro.test(rnorm(100))
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- Abundance[!is.na(Abundance$T1_ppb),]
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res3 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + factor(Functional.group), slab = paste(dat1$Authors, dat1$Year), test="knha")
shapiro.test(rstandard(res3)$resid)
hist(rstandard(res3)$resid)
regtest(res3)
regtest(res2)
Meta_MasterDataNEW_March.8 <- read.csv("~/Documents/Meta/Meta/Meta_MasterDataNEW_March 8.csv", sep=";")
View(Meta_MasterDataNEW_March.8)
Meta <- read.csv("~/Documents/Meta/Meta/Meta_MasterDataNEW_March 8.csv", sep=";")
View(Meta)
str(Meta)
Meta$Con_Mean
as.numeric(Meta$Con_Mean)
Meta <- read.csv("~/Documents/Meta/Meta/Meta_MasterDataNEW_March 8.csv", sep=";")
View(Meta)
Meta$Con_Mean
str(Meta)
saveRDS(Meta, "Meta.rds")
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
library(metafor)
#Abundance
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
View(Abundance)
summary(Abundance$AI.type)
summary(Abundance$Application.Units)
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
summary(Abundance_kg_ha)
colnames(Abundance_kg_ha)
summary(Abundance_kg_ha)
Abundance_kg_ha_t2 <- dplyr::filter(Abundance, !is.na(AI.rate_T2))
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.rate_T2))
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
summary(Abundance_kg_ha_t2)
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
#Abundance
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
nrow(Abundance_kg_ha)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- Abundance[!is.na(Abundance$T1_ppb),]
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_kg_ha, vtype = "UB")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- Abundance[!is.na(Abundance$T1_ppb),]
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha_t2$Study.T1..n. <- Abundance_kg_ha_t2$Study.T2..n.
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_kg_ha, vtype = "UB")
Abundance_kg_ha$Con_Mean
Abundance_kg_ha
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- Abundance[!is.na(Abundance$T1_ppb),]
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha_t2$Study.T1..n. <- Abundance_kg_ha_t2$Study.T2..n.
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
View(Abundance_kg_ha)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha_t2$Study.T1..n. <- Abundance_kg_ha_t2$Study.T2..n.
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_kg_ha, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred)) + geom_point() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(AI.Rate_T2))
Abundance_kg_ha_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance_kg_ha_t2$T1_SE <- Abundance_kg_ha_t2$T2_SE
Abundance_kg_ha_t2$Study.T1..n. <- Abundance_kg_ha_t2$Study.T2..n.
Abundance_kg_ha <- rbind(Abundance_kg_ha, Abundance_kg_ha_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_kg_ha, vtype = "UB")
res7 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
#res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb +  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res7, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model7 <- data.frame(model = "y ~ Concentration[Kg/Ha]", p_value = res7$QMp, R_squared = round(res7$R2/100,2), AICc = res7$fit.stats$ML[5])
model7
View(Abundance_kg_ha)
dplyr::filter(Abundance_kg_ha, TreatmentType == "powder/granular")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
View(Abundance_g_kg)
Abundance_g_kg <- dplyr::filter(Abundance_kg_ha, TreatmentType == "seed treatment")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg <- dplyr::filter(Abundance_kg_ha, TreatmentType == "seed treatment")
Abundance_g_kg_t2 <- dplyr::filter(Abundance_g_kg, !is.na(AI.Rate_T2))
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg <- dplyr::filter(Abundance_kg_ha, TreatmentType == "seed treatment")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg$TreatmentType
summary(Abundance_g_kg$TreatmentType)
summary(Abundance_g_kg)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg_t2 <- dplyr::filter(Abundance_g_kg, !is.na(AI.Rate_T2))
Abundance_g_kg_t2$AI.Rate_T1 <- Abundance_kg_ha_t2$AI.Rate_T2
Abundance_kg_ha_t2$T1_Mean <- Abundance_kg_ha_t2$T2_Mean
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg_t2 <- dplyr::filter(Abundance_g_kg, !is.na(AI.Rate_T2))
Abundance_g_kg_t2$AI.Rate_T1 <- Abundance_g_kg_t2$AI.Rate_T2
Abundance_g_kg_t2$T1_Mean <- Abundance_g_kg_t2$T2_Mean
Abundance_g_kg_t2$T1_SE <- Abundance_g_kg_t2$T2_SE
Abundance_g_kg_t2$Study.T1..n. <- Abundance_g_kg_t2$Study.T2..n.
Abundance_g_kg <- rbind(Abundance_g_kg, Abundance_g_kg_t2)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
Abundance_g_kg_t2 <- dplyr::filter(Abundance_g_kg, !is.na(AI.Rate_T2))
Abundance_g_kg_t2$AI.Rate_T1 <- Abundance_g_kg_t2$AI.Rate_T2
Abundance_g_kg_t2$T1_Mean <- Abundance_g_kg_t2$T2_Mean
Abundance_g_kg_t2$T1_SE <- Abundance_g_kg_t2$T2_SE
Abundance_g_kg_t2$Study.T1..n. <- Abundance_g_kg_t2$Study.T2..n.
Abundance_g_kg <- rbind(Abundance_g_kg, Abundance_g_kg_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res8 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res8, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model8 <- data.frame(model = "y ~ Concentration[g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res78fit.stats$ML[5])
model8 <- data.frame(model = "y ~ Concentration[g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res8fit.stats$ML[5])
model8 <- data.frame(model = "y ~ Concentration[g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res8$fit.stats$ML[5])
model8
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred)) + geom_point() + xlab("Concentration (g/kg)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
dat1
dat1$Study.T2..n.
dat1$Study.T1..n.
```{r, message=FALSE, warning=FALSE, echo=FALSE}
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res8 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res8, newmods = cbind(seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model8 <- data.frame(model = "y ~ Concentration[g/kg]", p_value = res8$QMp, R_squared = round(res8$R2/100,2), AICc = res8$fit.stats$ML[5])
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred)) + geom_point() + xlab("Concentration (g/kg)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
model8
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_kg_ha <- dplyr::filter(Abundance, Application.Units == "kg/ha")
Abundance_kg_ha <- dplyr::filter(Abundance_kg_ha, TreatmentType == "powder/granular")
View(Abundance_kg_ha)
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior <- Abundance[!is.na(Behavior$T1_ppb),]
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior <- Behavior[!is.na(Behavior$T1_ppb),]
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
model2
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
dat1$Study.T1..n.
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
summary(Behavior_ppb)
View(Behavior_ppb)
Behavior_ppb_t2 <- dplyr::filter(Abundance_kg_ha, !is.na(T2_ppb))
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2T2_ppb
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2$T2_ppb
Behavior_ppb_t2$T1_Mean <- Behavior_ppb_t2$T2_Mean
Behavior_ppb_t2$T1_SE <- Behavior_ppb_t2$T2_SE
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2$T2_ppb
Behavior_ppb_t2$T1_Mean <- Behavior_ppb_t2$T2_Mean
Behavior_ppb_t2$T1_SE <- Behavior_ppb_t2$T2_SE
Behavior_ppb_t2$Study.T1..n. <- Behavior_ppb_t2$Study.T2..n.
Behavior_ppb <- rbind(Behavior_ppb, Behavior_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb, slab = paste(dat1$Authors, dat1$Year))
#res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb +  factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
preds <- predict(res2, newmods = cbind(seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20)), addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.T1_ppb = preds$X[,2])
model2 <- data.frame(model = "y ~ Concentration", p_value = res2$QMp, R_squared = round(res2$R2/100,2), AICc = res2$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
model2
Behavior_ppb$Treatment.2
Summary(Behavior_ppb$Treatment.2)
summary(Behavior_ppb$Treatment.2)
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
Behavior_ppb <- Behavior[!is.na(Behavior$T1_ppb),]
Behavior_ppb_t2 <- dplyr::filter(Behavior_ppb, !is.na(T2_ppb))
Behavior_ppb_t2$T1_ppb <- Behavior_ppb_t2$T2_ppb
Behavior_ppb_t2$T1_Mean <- Behavior_ppb_t2$T2_Mean
Behavior_ppb_t2$T1_SE <- Behavior_ppb_t2$T2_SE
Behavior_ppb_t2$Study.T1..n. <- Behavior_ppb_t2$Study.T2..n.
Behavior_ppb <- rbind(Behavior_ppb, Behavior_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior_ppb, vtype = "UB")
res3 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + factor(Treatment.2), slab = paste(dat1$Authors, dat1$Year), test="knha")
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI"))
dum <- dummyVars(~ Treatment2, data = newmods)
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res3, newmods = NM[,1:3])
res3
preds <- predict(res3, newmods = NM[,1:2])
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, T1_ppb = newmods$T1_ppb, Treatment.2 = newmods$Treatment.2)
model3 <- data.frame(model = "y ~ Concentration + neonic type", p_value = res3$QMp, R_squared = round(res3$R2/100,2), AICc = res3$fit.stats$ML[5])
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
model3
res3
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(aes(size = size = Study.T1..n., color = Treatment.2))
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(aes(size = size = Study.T1..n.))
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.T1_ppb, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.T1_ppb, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = pred))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data = dat1)
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
dat1$yi
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data = dat1)
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point(data = dat1)
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point()
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point() + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point() + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point() + geom_ribbon(data = preds, alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2))
ggplot(dat1, aes(x = T1_ppb, y = yi)) + geom_point()
preds
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point()
colnames(dat1)
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data= dat1, aes(x = T1_ppb, y = yi))
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n.))
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Study.T1..n.))
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2))
```
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
hist(dat1$T1_ppb)
dat1$T1_ppb
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()+ scale_x_log10()
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance, vtype = "UB")
res <- rma(yi, vi, data=dat1, refline = 0, method = "HE", slab = paste(dat1$Authors, dat1$Year))
model0 <- data.frame(model = "y ~ 1", p_value = res1QMp, R_squared = round(res$R2/100,2), AICc = res$fit.stats$ML[5])
res$QEp
model0 <- data.frame(model = "y ~ 1", p_value = res$QMp, R_squared = round(res$R2/100,2), AICc = res$fit.stats$ML[5])
res$QMp
round(res$R2/100,2)
AICc = res$fit.stats$ML[5]
AICc
model0 <- data.frame(model = "y ~ 1", p_value = res$QMp, R_squared = NULL, AICc = res$fit.stats$ML[5])
model0 <- data.frame(model = "y ~ 1", p_value = res$QMp, R_squared = 0, AICc = res$fit.stats$ML[5])
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
res9
summary(Abundance_g_kg$Functional.group)
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
model9
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
preds <- predict(res9, newmods = newmods, addx = TRUE)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
newmods
newmods
res9
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
NM
preds <- predict(res9, newmods = NM[,1:3])
preds <- predict(res9, newmods = NM[,1:2])
preds <- predict(res9, newmods = newmods, addx = TRUE)
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds
View(preds)
model9
NM <- cbind(newmods[,1],predict(dum, newmods))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
dat1$Nesting.Area
summary(dat1$Nesting.Area)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
library(caret)
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res10 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Nesting.Area = c("aboveground", "both"))
dum <- dummyVars(~ Nesting.Area, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res10, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
dum <- dummyVars(~ Nesting.Area, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res10, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model10 <- data.frame(model = "y ~ Concentration [g/kg] + Nesting Area", p_value = res10$QMp, R_squared = round(res10$R2/100,2), AICc = res10$fit.stats$ML[5])
model10
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
dat1$Functional.group
summary(dat1$Functional.group)
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance <- dplyr::filter(Meta, Fitness.measure == "abundance")
Abundance_g_kg <- dplyr::filter(Abundance, Application.Units == "g/kg")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Abundance_g_kg, vtype = "UB")
res9 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  AI.Rate_T1+ factor(Functional.group), slab = paste(dat1$Authors, dat1$Year))
library(caret)
newmods = expand.grid(AI.Rate_T1 = seq(from = min(dat1$AI.Rate_T1), to = max(dat1$AI.Rate_T1), length.out =  20), Functional.group = c("mixed", "predator"))
dum <- dummyVars(~ Functional.group, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2])
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = "grey", alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = Functional.group, alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
preds
NM
newmods
preds <- predict(res9, newmods = NM[,1:2], addx = TRUE)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, X.AI.Rate_T1 = preds$X[,2], Functional.group = newmods$Functional.group)
model9 <- data.frame(model = "y ~ Concentration [g/kg] + Functional group", p_value = res9$QMp, R_squared = round(res9$R2/100,2), AICc = res9$fit.stats$ML[5])
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub), fill = Functional.group, alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
preds
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2)
ggplot(dat1, aes(x = T1_ppb, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point(aes(size = Study.T1..n.)) + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
ggplot(dat1, aes(x = AI.Rate_T1, y = yi))  + geom_ribbon(data = preds, aes(x = X.AI.Rate_T1, y = pred, ymin = ci.lb, ymax = ci.ub, fill = Functional.group), alpha = 0.5) + theme_classic() + geom_line(data = preds, aes(x = X.AI.Rate_T1, y = pred, lty = Functional.group)) + geom_point() + xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey()
dat1$AI.type
Meta <- readRDS("Meta.rds")
library(ggplot2)
library(metafor)
Meta$Study.Type
Behavior <- dplyr::filter(Meta, Fitness.measure == "behavior")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
Meta$Study.Type
Behavior$Study.Type
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Behavior, vtype = "UB")
res5 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Studt.Type), slab = paste(dat1$Authors, dat1$Year))
model5 <- data.frame(model = "y ~ study type", p_value = res5$QMp, R_squared = round(res5$R2/100,2), AICc = res5$fit.stats$ML[5])
dat1$Study.Type
res5 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Study.Type), slab = paste(dat1$Authors, dat1$Year))
model5 <- data.frame(model = "y ~ study type", p_value = res5$QMp, R_squared = round(res5$R2/100,2), AICc = res5$fit.stats$ML[5])
model5
vars<-c('a','b','c','d')
library(gregmisc)
indexes<-unique(apply(combinations(length(vars), length(vars), repeats=T), 1, unique))
gen.form<-function(x) as.formula(paste('~',paste( vars[x],collapse='+')))
formulas<-lapply(indexes, gen.form)
formulas
install.packages("gregmisc")
install.packages(gregmisc)
regMat <- expand.grid(c(TRUE,FALSE), c(TRUE,FALSE),
c(TRUE,FALSE), c(TRUE,FALSE))
regMat
regMat <- expand.grid(c(TRUE,FALSE), c(TRUE,FALSE),
c(TRUE,FALSE), c(TRUE,FALSE), c(TRUE, FALSE))
regMat
dat1$AI.type
exp(-0.5)
ALL
Meta$Fitness.measure
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res1 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Functional.group) + factor(Order), slab = paste(dat1$Authors, dat1$Year))
model1 <- data.frame(model = "y ~ Order + Functional group", p_value = res1$QMp, R_squared = round(res1$R2/100,2), AICc = res1$fit.stats$ML[5])
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
library(metafor)
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res1 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Functional.group) + factor(Order), slab = paste(dat1$Authors, dat1$Year))
model1 <- data.frame(model = "y ~ Order + Functional group", p_value = res1$QMp, R_squared = round(res1$R2/100,2), AICc = res1$fit.stats$ML[5])
model1
Meta$Treatment.2
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction, vtype = "UB")
res2 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~ factor(Nesting.Area), slab = paste(dat1$Authors, dat1$Year))
dat1$Treatment.2
summary(dat1$Treatment.2)
res1
res2
Reproduction <- dplyr::filter(Meta, Fitness.measure == "reproduction")
Reproduction_ppb <- Reproduction[!is.na(Reproduction$T1_ppb),]
Reproduction_ppb_t2 <- dplyr::filter(Reproduction_ppb, !is.na(T2_ppb))
Reproduction_ppb_t2$T1_ppb <- Reproduction_ppb_t2$T2_ppb
Reproduction_ppb_t2$T1_Mean <- Reproduction_ppb_t2$T2_Mean
Reproduction_ppb_t2$T1_SE <- Reproduction_ppb_t2$T2_SE
Reproduction_ppb_t2$Study.T1..n. <- Reproduction_ppb_t2$Study.T2..n.
Reproduction_ppb <- rbind(Reproduction_ppb, Reproduction_ppb_t2)
dat1 <- escalc(measure="SMDH", m2i=Con_Mean, sd2i=Con_SE, n2i=Study.control..n., m1i=T1_Mean, sd1i=T1_SE, n1i=Study.T1..n., data=Reproduction_ppb, vtype = "UB")
res4 <- rma(yi, vi, data=dat1, refline = 0, method = "HE", mods =~  T1_ppb + Treatment.2, slab = paste(dat1$Authors, dat1$Year))
summary(dat1$Treatment.2)
res4
summary(dat1$Treatment.2)
library(caret)
newmods = expand.grid(T1_ppb = seq(from = min(dat1$T1_ppb), to = max(dat1$T1_ppb), length.out =  20), Treatment.2 = c("CLO", "IMI", "MIX", "THX"))
dum <- dummyVars(~ Treatment.2, data = newmods)
NM <- cbind(newmods[,1],predict(dum, newmods))
preds <- predict(res3, newmods = NM[,1:3])
preds <- predict(res4, newmods = NM[,1:3])
preds <- predict(res4, newmods = NM[,1:4])
preds
model4 <- data.frame(model = "y ~ Concentration [ppb] + Neonic type", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
model4
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
class(preds)
preds <- data.frame(pred = preds$pred, ci.lb = preds$ci.lb, ci.ub = preds$ci.ub, T1_ppb = newmods$T1_ppb, Treatment.2 = newmods$Treatment.2)
model4 <- data.frame(model = "y ~ Concentration [ppb] + Neonic type", p_value = res4$QMp, R_squared = round(res4$R2/100,2), AICc = res4$fit.stats$ML[5])
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey() + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey()
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type") + scale_size(name = "n")
ggplot(preds, aes(x = T1_ppb, y = pred))  + geom_ribbon(alpha = 0.5,aes(ymin = ci.lb, ymax = ci.ub, fill = Treatment.2)) + theme_classic() + geom_line(aes(lty = Treatment.2))+ xlab("Concentration (ppb)") + ylab("Standardized mean difference") + geom_hline(yintercept = 0, lty= 2) + scale_fill_grey(name = "Neonic Type") + geom_point(alpha = 0.8, data= dat1, aes(x = T1_ppb, y = yi, size = Study.T1..n., color = Treatment.2)) + scale_color_grey(name = "Neonic Type") + scale_linetype(name = "Neonic Type") + scale_size(name = "n") + scale_x_log10()
res5
res4
